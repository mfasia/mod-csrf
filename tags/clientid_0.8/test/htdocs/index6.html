<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>index 6</title>

<script type="text/javascript">

var counter1 = 0;

function autoStart() {
  var d = new Date();
  var n = d.getTime();
  counter1 = n % 100000;
  setInterval("doPOST()", 2000);
}

function doPOST() {
  var url = "/update.txt" + "?" + "id=" + counter1;
  var params = "foo=" + dec64("YmFyCg==") + "&name=alice";
  var update = document.getElementById("autoupdate");
  var http = new XMLHttpRequest();

  counter1++;

  http.open("POST", url, true);
  http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  http.setRequestHeader("Content-length", params.length);
  http.setRequestHeader("Connection", "close");

  http.onreadystatechange = function() {
    if(http.readyState == 4 && http.status == 200) {
      update.innerHTML = "<b>" + counter1 + "</b><br>" + http.responseText;
    } else {
      update.innerHTML = "FAILED!!!";
    }
  }
  http.send(params);
}

function dec64(s) {
    var e={},i,b=0,c,x,l=0,a,r='',w=String.fromCharCode,L=s.length;
    var A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    for(i=0;i<64;i++){e[A.charAt(i)]=i;}
    for(x=0;x<L;x++){
        c=e[s.charAt(x)];b=(b<<6)+c;l+=6;
        while(l>=8){((a=(b>>>(l-=8))&0xff)||(x<(L-2)))&&(r+=w(a));}
    }
    return r;
}

autoStart();

</script>
  </head>

  <body>
    <h1>page 6</h1>
<p>ajax POST requests (15 bytes)</p>
<ul>
    <li><a href="/index.html">home</a></li>
    <li><a href="/index3.html">index 3</a></li>
    <li><a href="/index4.html">index 4</a></li>
    <li><a href="/index5.html">index 5</a></li>
    <li><a href="/index7.html">index 7</a></li>
    <li><a href="/index8.html">index 8</a></li>
</ul>

<p>
<div id="autoupdate">-</div>
</p>

<p>
<div id="decoded">-</div>
</p>


    <hr>
<script type="text/javascript">
var decodedNode = document.getElementById("decoded");
var dec = dec64("MTIzCg==");
decodedNode.innerHTML = "id=<b>" + dec + "</b>";
</script>
  </body>
</html>
